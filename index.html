<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>michaael jackson ecommerce - valery zarate</title>
  <meta name="description" content="Tienda demo con carrito, filtro, localStorage y pago PayPal sandbox." />

  <style>
    /* ---------- PALETA: negro + azul mate + blanco ---------- */
    :root{
      --bg:#0C0C0F;        /* negro profundo */
      --panel:#0D1B2A;     /* azul mate oscuro */
      --card:#1B263B;      /* azul intermedio */
      --text:#FFFFFF;      /* blanco */
      --muted:#A7BCD0;     /* gris azulado suave */
      --accent:#415A77;    /* acento azul claro */
      --ok:#2EA043;        /* verde para botones OK */
      --warn:#D9534F;      /* rojo para eliminar */
      --border:#233447;    /* borde sutil */
      --radius:12px;
      --shadow: 0 6px 18px rgba(2,8,23,0.6);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg) 0%, #071024 100%);
      color:var(--text);
      padding:20px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      background: linear-gradient(90deg,var(--panel), #112634);
      padding:18px;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    header .brand{
      display:flex;
      gap:12px;
      align-items:center;
    }
    header h1{margin:0;font-size:20px;color:var(--accent)}
    header p{margin:0;color:var(--muted);font-size:13px}

    .filtros{display:flex;gap:10px;align-items:center}
    label{color:var(--muted);font-size:14px}
    select{
      background:transparent;
      color:var(--text);
      border:1px solid var(--border);
      padding:8px 10px;
      border-radius:10px;
      min-width:160px;
    }

    main{display:grid;grid-template-columns: 1fr 360px; gap:20px; margin-top:20px;}
    @media (max-width:1000px){ main{grid-template-columns: 1fr; } }

    /* Productos grid */
    #productos{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap:14px;
    }
    .producto{
      background:linear-gradient(180deg,var(--card), #122235);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      box-shadow: 0 6px 14px rgba(2,8,23,0.45);
    }
    .producto img{
      width:100%;
      height:200px;
      object-fit:cover;
      border-radius:8px;
      background:#0b0e16;
    }
    .producto h3{margin:0;font-size:16px;color:var(--text)}
    .producto p{margin:0;color:var(--muted);font-size:14px}
    .producto .actions{margin-top:auto;display:flex;gap:8px;align-items:center}
    .btn{
      background:var(--accent);
      border:none;
      color:var(--text);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:transform .12s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent;border:1px solid var(--border);color:var(--muted)}

    /* Carrito panel */
    .carrito{
      background: linear-gradient(180deg,var(--panel), #0b1624);
      padding:18px;
      border-radius:var(--radius);
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      position:relative;
    }
    .carrito h2{margin:0 0 8px 0;color:var(--accent);font-size:18px}
    .carrito p{margin:0;color:var(--muted);font-size:13px}

    #lista-carrito{list-style:none;padding:0;margin:12px 0 0;max-height:360px;overflow:auto}
    #lista-carrito li{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      background:linear-gradient(180deg,#0f1b2a, #08101a);
      border:1px solid var(--border);
      padding:8px;
      border-radius:8px;
      margin-bottom:10px;
      font-size:14px;
      color:var(--muted);
    }
    #lista-carrito li span.name{flex:1}
    .qty{display:flex;gap:6px;align-items:center}
    .qty button{
      background:transparent;border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:6px;cursor:pointer;
    }
    .remove{background:var(--warn);border:none;color:white;padding:6px;border-radius:6px;cursor:pointer}

    .totales{margin-top:12px;border-top:1px dashed var(--border);padding-top:10px;color:var(--muted)}
    .totales p{display:flex;justify-content:space-between;margin:6px 0;font-size:15px}
    .totales .total strong{font-size:18px;color:var(--text)}

    .acciones{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .vaciar{background:var(--warn);border:none;color:white;padding:10px 12px;border-radius:8px;cursor:pointer}
    .finalizar{background:var(--ok);border:none;color:white;padding:10px 12px;border-radius:8px;cursor:pointer}

    .pago{margin-top:14px;background:linear-gradient(180deg,#0f2130,#07121a);padding:12px;border-radius:10px;border:1px solid var(--border)}
    .hint{margin-top:8px;background:transparent;color:var(--muted);font-size:13px}

    footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center}
    code{background:#071124;padding:2px 6px;border-radius:6px;color:var(--muted)}
  </style>
</head>
<body>
  <header role="banner" aria-label="Encabezado tienda">
    <div class="brand">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <rect width="24" height="24" rx="6" fill="#1B263B"></rect>
        <path d="M6 12h12" stroke="#415A77" stroke-width="1.5" stroke-linecap="round"></path>
        <path d="M6 7h12" stroke="#778DA9" stroke-width="0.9" stroke-linecap="round"></path>
      </svg>
      <div>
        <h1>üçΩÔ∏è michaael jackson ecommerce</h1>
        <p>valery zarate ‚Äî demo tienda</p>
      </div>
    </div>

    <div class="filtros" role="region" aria-label="Filtros">
      <div>
        <label for="categoria">Filtrar por categor√≠a</label><br />
        <select id="categoria" aria-label="Seleccionar categor√≠a">
          <option value="todos">Todos</option>
          <option value="Music">Music</option>
          <option value="Outfits">Outfits</option>
          <option value="Merch">Merch</option>
          <option value="Phrases">Phrases</option>
          <option value="Songs">Songs</option>
        </select>
      </div>
    </div>
  </header>

  <main id="main" tabindex="-1">
    <!-- Productos -->
    <section id="productos" aria-live="polite" aria-busy="false"></section>

    <!-- Carrito -->
    <aside class="carrito" aria-label="Carrito de compras">
      <h2>üßæ Carrito de Compras</h2>
      <p>Productos en carrito: <strong id="cantidad-carrito">0</strong></p>

      <ul id="lista-carrito" aria-label="Lista de productos en el carrito"></ul>

      <div class="totales" aria-live="polite">
        <p><span>Subtotal</span><span id="subtotal-text">$0.00</span></p>
        <p><span>Descuento</span><span id="descuento-text">$0.00</span></p>
        <p><span>Impuestos</span><span id="impuestos-text">$0.00</span></p>
        <p class="total"><strong>Total</strong><strong id="total-text">$0.00</strong></p>
      </div>

      <div class="acciones" role="group" aria-label="Acciones del carrito">
        <button id="btn-vaciar" class="vaciar" type="button">üßº Vaciar</button>
        <button id="btn-finalizar" class="finalizar" type="button">‚úÖ Finalizar Compra</button>
      </div>

      <div class="pago" aria-label="Pago">
        <h3>üí≥ M√©todo de pago</h3>
        <div id="paypal-button-container" style="margin-top:10px; display:none;"></div>
        <p class="hint">‚ö†Ô∏è Se muestra PayPal sandbox solo si el total es mayor a $0. Usa tu Client ID de pruebas si quieres recibir pagos reales.</p>
      </div>
    </aside>
  </main>

  <footer>
    <small>Demo educativo ‚Ä¢ Mant√©n las rutas de imagen y el dataset tal como est√°n.</small>
  </footer>

  <!-- PayPal SDK (sandbox por defecto, client-id=sb). Cambia "sb" por tu client-id de sandbox/producci√≥n -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD&components=buttons,funding-eligibility"></script>

  <script>
    /* =========================
       CONFIG
       ========================= */
    const MONEDA   = 'USD';      // Moneda mostrada en el pago PayPal
    const LOCALE   = 'es-CO';    // Localizaci√≥n para Intl.NumberFormat (puedes cambiar)
    const TAX_RATE = 0.00;       // 0.19 si aplica IVA
    const DESCUENTO = 0.00;      // Descuento fijo aplicable al total

    /* =========================
       DATASET (us√© tus im√°genes/rutas tal cual)
       Cada producto debe tener: id, nombre, precio (Number), categoria, img
    ========================= */
    const productos = [
      { id: 1, nombre: "music",      precio: 25.00, categoria: "Music",
        img: "https://m.media-amazon.com/images/M/MV5BMTM1NjExNjg1OV5BMl5BanBnXkFtZTcwMTQ0NzIwMw@@._V1_FMjpg_UX1000_.jpg" },
      { id: 2, nombre: "Best outfits", precio: 18.00, categoria: "Outfits",
        img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_GPfbhESVvvkBN0YYFzOgDlkWvRBJ4cRGlA&s" },
      { id: 3, nombre: ",merch",     precio: 30.00, categoria: "Merch",
        img: "https://i0.wp.com/kalivira.com/wp-content/uploads/2024/03/Michael-Jackson-T-Shirt-White.webp" },
      { id: 4, nombre: "phrases",    precio: 18.00, categoria: "Phrases",
        img: "https://i.pinimg.com/564x/21/fe/26/21fe26c6cde475882e016530a4e62b84.jpg" },
      { id: 5, nombre: "Best songs", precio: 22.00, categoria: "Songs",
        img: "https://i.scdn.co/image/ab67616d0000b27376bfd700e0c47fae7f2c7b75" }
    ];

    /* =========================
       ESTADO y SELECTORES
    ========================= */
    let carrito = new Map();

    const sel = {
      contProds: document.getElementById('productos'),
      lista:     document.getElementById('lista-carrito'),
      subtotal:  document.getElementById('subtotal-text'),
      impuestos: document.getElementById('impuestos-text'),
      descuento: document.getElementById('descuento-text'),
      total:     document.getElementById('total-text'),
      cantidad:  document.getElementById('cantidad-carrito'),
      select:    document.getElementById('categoria'),
      btnVaciar: document.getElementById('btn-vaciar'),
      btnFinal:  document.getElementById('btn-finalizar'),
      paypal:    document.getElementById('paypal-button-container')
    };

    const money = new Intl.NumberFormat(LOCALE, { style: 'currency', currency: MONEDA });

    /* =========================
       RENDER PRODUCTOS
    ========================= */
    function renderProductos(lista){
      sel.contProds.setAttribute('aria-busy','true');
      sel.contProds.innerHTML = '';

      if (!Array.isArray(lista) || lista.length === 0){
        sel.contProds.innerHTML = `<div style="color:var(--muted);padding:20px;border-radius:8px;background:transparent">No hay productos para mostrar.</div>`;
        sel.contProds.setAttribute('aria-busy','false');
        return;
      }

      lista.forEach(p => {
        const card = document.createElement('article');
        card.className = 'producto';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.nombre}">
          <h3>${escapeHTML(p.nombre)}</h3>
          <p>Precio: <strong>${money.format(Number(p.precio)||0)}</strong></p>
          <div class="actions">
            <button class="btn" data-add="${p.id}">Agregar</button>
            <button class="btn secondary" data-view="${p.id}" aria-label="Ver detalles">Detalles</button>
          </div>
        `;
        const img = card.querySelector('img');
        img.addEventListener('error', () => {
          img.src = 'https://via.placeholder.com/400x600?text=Imagen+no+disponible';
          img.alt = p.nombre + ' (imagen no disponible)';
        });
        sel.contProds.appendChild(card);
      });

      sel.contProds.setAttribute('aria-busy','false');
    }

    /* =========================
       FILTRADO
    ========================= */
    function filtrar(){
      const categoria = sel.select.value;
      const data = categoria === 'todos' ? productos : productos.filter(p => String(p.categoria) === categoria);
      renderProductos(data);
      localStorage.setItem('filtro_categoria', categoria);
    }
    function cargarFiltro(){
      const f = localStorage.getItem('filtro_categoria');
      if (f) sel.select.value = f;
    }

    /* =========================
       CARRITO + PERSISTENCIA + TOTALES
    ========================= */
    function persist(){ localStorage.setItem('carrito', JSON.stringify(Array.from(carrito.entries()))); }
    function loadCarrito(){
      const raw = localStorage.getItem('carrito');
      if (raw){
        try{
          carrito = new Map(JSON.parse(raw));
        }catch(e){ carrito = new Map(); }
      }
    }

    function totales(){
      const subtotal = [...carrito.values()].reduce((acc, i) => acc + Number(i.precio||0) * Number(i.cantidad||0), 0);
      const desc = Math.min(DESCUENTO, subtotal);
      const base = subtotal - desc;
      const impuestos = +(base * TAX_RATE).toFixed(2);
      const total = +(base + impuestos).toFixed(2);
      const cantidad = [...carrito.values()].reduce((a,i)=> a + Number(i.cantidad||0), 0);
      return { subtotal, descuento: desc, impuestos, total, cantidad };
    }

    function pintarCarrito(){
      sel.lista.innerHTML = '';
      if (carrito.size === 0){
        sel.lista.innerHTML = '<li style="color:var(--muted);padding:8px;border-radius:8px">El carrito est√° vac√≠o.</li>';
      } else {
        carrito.forEach(it => {
          const li = document.createElement('li');
          li.innerHTML = `
            <span class="name">${escapeHTML(it.nombre)} ‚Äî ${money.format(it.precio)} x ${it.cantidad}</span>
            <div class="qty">
              <button aria-label="Disminuir cantidad" data-dec="${it.id}">‚àí</button>
              <span aria-live="polite">${it.cantidad}</span>
              <button aria-label="Aumentar cantidad" data-inc="${it.id}">+</button>
              <button class="remove" aria-label="Eliminar producto" data-del="${it.id}">‚ùå</button>
            </div>
          `;
          sel.lista.appendChild(li);
        });
      }

      const {subtotal,descuento,impuestos,total,cantidad} = totales();
      sel.subtotal.textContent  = money.format(subtotal);
      sel.descuento.textContent = money.format(descuento);
      sel.impuestos.textContent = money.format(impuestos);
      sel.total.textContent     = money.format(total);
      sel.cantidad.textContent  = cantidad;

      // PayPal: mostrar solo si total > 0
      sel.paypal.style.display = total > 0 ? 'block' : 'none';
      renderPayPal(total);
    }

    function addToCart(id){
      const p = productos.find(x => x.id === id);
      if (!p) return alert('Producto no encontrado. Revisa el dataset.');
      const it = carrito.get(id);
      if (it) it.cantidad = Number(it.cantidad||0) + 1;
      else carrito.set(id, {...p, cantidad:1});
      persist(); pintarCarrito();
    }
    function decFromCart(id){
      const it = carrito.get(id);
      if (!it) return;
      it.cantidad = Number(it.cantidad||0) - 1;
      if (it.cantidad <= 0) carrito.delete(id);
      persist(); pintarCarrito();
    }
    function delFromCart(id){
      carrito.delete(id);
      persist(); pintarCarrito();
    }

    /* =========================
       PAYPAL (sandbox)
       - usa client-id=sb por defecto (pruebas).
       - si quieres recibir pagos reales, reemplaza "sb" por tu client-id.
    ========================= */
    let paypalRenderedTotal = null;
    function renderPayPal(total){
      if (!window.paypal) return;
      if (total <= 0){ paypalRenderedTotal = null; sel.paypal.innerHTML = ''; return; }
      // Si ya est√° renderizado para este total, no volver a crear botones
      if (paypalRenderedTotal === total && sel.paypal.childElementCount > 0) return;

      paypalRenderedTotal = total;
      sel.paypal.innerHTML = '';

      paypal.Buttons({
        style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'pay' },
        createOrder: (data, actions) => {
          return actions.order.create({
            purchase_units: [{
              amount: { value: total.toFixed(2), currency_code: MONEDA }
            }]
          });
        },
        onApprove: (data, actions) => {
          return actions.order.capture().then(details => {
            const cliente = details?.payer?.name?.given_name || 'cliente';
            alert(`üéâ ¬°Gracias ${cliente}! Pago aprobado (sandbox).`);
            carrito.clear(); persist(); pintarCarrito();
          });
        },
        onError: (err) => {
          console.error('PayPal error', err);
          alert('Ocurri√≥ un error con el pago. Reintenta m√°s tarde.');
        }
      }).render('#paypal-button-container');
    }

    /* =========================
       EVENTOS (delegados)
    ========================= */
    document.addEventListener('click', (e) => {
      const addBtn = e.target.closest('[data-add]');
      if (addBtn) { addToCart(+addBtn.dataset.add); return; }

      const incBtn = e.target.closest('[data-inc]');
      if (incBtn) { addToCart(+incBtn.dataset.inc); return; }

      const decBtn = e.target.closest('[data-dec]');
      if (decBtn) { decFromCart(+decBtn.dataset.dec); return; }

      const delBtn = e.target.closest('[data-del]');
      if (delBtn) { delFromCart(+delBtn.dataset.del); return; }
    });

    sel.select.addEventListener('change', filtrar);
    sel.btnVaciar.addEventListener('click', () => {
      if (!confirm('¬øVaciar carrito?')) return;
      carrito.clear(); persist(); pintarCarrito();
    });
    sel.btnFinal.addEventListener('click', () => {
      if (carrito.size === 0) return alert('El carrito est√° vac√≠o. Agrega productos antes de finalizar.');
      // simulaci√≥n de pedido
      alert('‚úÖ Pedido confirmado (simulaci√≥n). Gracias por comprar en la demo.');
      carrito.clear(); persist(); pintarCarrito();
    });

    /* =========================
       UTILIDADES & INIT
    ========================= */
    function escapeHTML(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    // cargar estado y mostrar UI
    (function init(){
      cargarFiltro();
      renderProductos(productos);
      loadCarrito();
      pintarCarrito();
      // accesibilidad: llevar foco al main
      document.getElementById('main')?.focus({preventScroll:true});
    })();
  </script>
</body>
</html>


